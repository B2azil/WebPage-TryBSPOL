<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Szczegóły produktu</title>
  <!-- <link rel="stylesheet" href="css/reset.css"> -->
  <link rel="stylesheet" href="css/product.css">
  <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  
</head>
<body>
  <div class="product-container" id="productDetails">
    <p>Ładowanie danych produktu...</p>
  </div>

  <script>
    async function loadProductDetails() {
      const params = new URLSearchParams(window.location.search);
      const prodId = params.get('id');

      if (!prodId) {
        document.getElementById('productDetails').innerHTML = '<p>Nie podano produktu.</p>';
        return;
      }

      try {
        const response = await fetch('produkty_legia.csv');
        const data = await response.text();

        const results = Papa.parse(data, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: false,
          delimiter: ';'  // ustaw separator na średnik
        });
        const products = results.data;


        // Odnajdź produkt po nazwie (prodId jest w URL zakodowane, więc dekoduj)
        const decodedProdId = decodeURIComponent(prodId);
        const product = products.find(p => p.name === decodedProdId);

        if (!product) {
          document.getElementById('productDetails').innerHTML = '<p>Produkt nie znaleziony.</p>';
          return;
        }
        
        // Dynamiczne wyświetlanie dostępnych zdjęć
        const images = [product.image, product.image2, product.image3, 
                        product.image4, product.image5, product.image6, 
                        product.image7, product.image8
                      ];
        const imagesHtml = images
          .filter(src => src && src.trim() !== '')
          .map(src => `<img src="${src}" alt="${product.name}">`)
          .join('');

        // Dynamiczne wyświetlanie dostępnych informacji o produkcie
        const infoFields = ['info1', 'info2', 'info3', 'info4',
                            'info5', 'info6', 'info7', 'info8',
                            'info9', 'info10', 'info11', 'info12',
                            'info13', 'info14', 'info15', 'info16'
                          ];
        const infosHtml = infoFields
          .map(field => product[field])
          .filter(text => text && text.trim() !== '')
          .map(text => `<p class="description">${text}</p>`)
          .join('');  

        
        /*
          Opis: Sekcja odpowiedzialna za wyświetlanie szczegółowych informacji o produkcie,
          renderowanych dynamicznie na podstawie danych z pliku.
        */
        document.getElementById('productDetails').innerHTML = `
          <div class="parent">

            <div class="product-basic">
              <h1>${product.name}</h1>
              <h6>SKU: ${product.sku}</h6>
              <div class="price">Cena: ${product.price} zł</div>
            </div>

            <div class="product-images">${imagesHtml}</div>

            <div class="category">Kategoria: ${product.category}</div>

            <a href="${product.link}" target="_blank" class="link"><img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Allegro.pl_sklep.svg" alt="Allegro"></a>
          
          
            <div class="product-description">
              <b>Opis produktu</b>
              ${infosHtml}
            </div>

            <div class="product-data">
              <b>Dane techniczne produktu</b>
              <div>Wysokość: ${product.height} cm</div>
              <div>Szerokość: ${product.width} cm</div>
              <div>Głębokość: ${product.depth} cm</div>
              <div>Waga produktu: ${product.weight} g</div>
              <div>Materiał: ${product.material}</div>
              <div>Kolor dominujący: ${product.color}</div>
            </div>

            <span class="top">
              <a href="${product.brandPage || 'main.html'}" class="back-link">← Powrót do listy ${product.brand}</a>
            </span>

          </div>
        `;

      } catch (error) {
        document.getElementById('productDetails').innerHTML = '<p>Błąd podczas ładowania danych produktu.</p>';
        console.error('Błąd ładowania CSV:', error);
      }
    }

    loadProductDetails();
  </script>
</body>
</html>
