<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B&S Polska produkty</title>
    <link rel="stylesheet" href="css/brand.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<header>
    <a href="/">&larr; Powrót</a>
    <img src="img/bspolska.png" alt="Logo marki" class="brand-logo">
</header>

<div class="search-bar">
    <input type="text" id="search" placeholder="Szukaj produktu...">
</div>

<div class="category-bar" id="categoryBar">
    <!-- Kategorie z CSV -->
</div>

<div class="product-grid" id="productList">
    <!-- Produkty z CSV -->
</div>

<script>
let products;
let activeCategory;

function getBrandFromQuery() {
  const params = new URLSearchParams(window.location.search);
  const brand = params.get('brand');
  return brand;
}

function csvPathForBrand(brand) {
  return `brand/brand_${brand}.csv`; // np. brand_Legia-Warszawa.csv
}

async function loadProducts() {
  const brand = getBrandFromQuery();
  if (!brand) {
    document.getElementById('productList').innerHTML = '<p>Brak parametru brand.</p>';
    return;
  }
  try {
    const response = await fetch(csvPathForBrand(brand));
    const data = await response.text();
    const results = Papa.parse(data, {
      header: true,
      skipEmptyLines: true,
      dynamicTyping: false
    });
    products = results.data;
    generateCategories();
    render();
  } catch (e) {
    document.getElementById('productList').innerHTML = '<p>Nie udało się wczytać danych.</p>';
    console.error('CSV load error', e);
  }
}

document.addEventListener('DOMContentLoaded', loadProducts);

function generateCategories() {
    const categoryBar = document.getElementById('categoryBar');
    categoryBar.innerHTML = '';

    const categories = [...new Set(products.map(p => p.category))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.addEventListener('click', () => {
            if (activeCategory === cat) {
                activeCategory = '';
            } else {
                activeCategory = cat;
            }
            updateCategoryButtons();
            render();
        });
        categoryBar.appendChild(btn);
    });
}

function updateCategoryButtons() {
    document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.textContent === activeCategory) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

function render() {
    const searchValue = document.getElementById('search').value.toLowerCase();
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    products
        .filter(p =>
    (!activeCategory || p.category === activeCategory) &&
    (p.name.toLowerCase().includes(searchValue) || 
     p.category.toLowerCase().includes(searchValue))
)

        .forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="img/${p.brand}/${p.image}" alt="${p.name}" class="product-image">
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-BarCode">${p.BarCode}</div>
                    <div class="product-category">${p.category}</div>
                    <div class="product-price">cena sugerowana: ${p.price} PLN</div>
                    <div class="product-dimensions">
                        <span>${p.height}</span>
                        <span>${p.width}</span>
                        <span>${p.depth} cm</span>    
                    </div>
                </div>
            `;
            
            card.addEventListener('click', function() {
                window.location.href = 'product.html?id=' + encodeURIComponent(p.name);
            });
            
            productList.appendChild(card);
        });
}

document.getElementById('search').addEventListener('input', render);

</script>

</body>
</html>
