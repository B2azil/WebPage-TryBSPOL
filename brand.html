<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B&S Polska produkty</title>
    <link rel="icon" type="image/png" href="main\img\bspolska.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="css/brand.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<header>
    <a href="https://b2azil.github.io/WebPage-TryBSPOL/">&larr; Powrót</a> <!-- w a href="/" gdy ustawisz juz domene -->
    <img src="img/bspolska.png" alt="Logo marki" class="brand-logo">
</header>

<div class="search-bar">
    <input type="text" id="search" placeholder="Szukaj produktu...">
</div>

<div class="category-bar" id="categoryBar">
    <!-- Kategorie z CSV -->
</div>

<div class="product-grid" id="productList">
    <!-- Produkty z CSV -->
</div>

<script>
let products;
let activeCategory;

function getBrandFromQuery() {
  const params = new URLSearchParams(window.location.search);
  const brand = params.get('brand');
  return brand;
}

function csvPathForBrand(brand) {
  return `brand/brand_${brand}.csv`; // np. brand_Legia-Warszawa.csv
}

async function loadProducts() {
  const brand = getBrandFromQuery();
  if (!brand) {
    document.getElementById('productList').innerHTML = '<p>Brak parametru brand.</p>';
    document.title = 'B&S Polska produkty - Błąd';
    return;
  }
  try {
    const response = await fetch(csvPathForBrand(brand));
    const data = await response.text();
    const results = Papa.parse(data, {
      header: true,
      skipEmptyLines: true,
      dynamicTyping: false,
        delimiter: ";", // ustaw separator na średnik
    });
    products = results.data;
    const brandName = products[0]?.brand;
    document.title = `${brandName} - produkty B&S Polska`;
    generateCategories();
    render();
  } catch (e) {
    document.getElementById('productList').innerHTML = '<p>Nie udało się wczytać danych.</p>';
    console.error('CSV load error', e);
  }
}
    
document.addEventListener('DOMContentLoaded', loadProducts);

function generateCategories() {
    const categoryBar = document.getElementById('categoryBar');
    categoryBar.innerHTML = '';

    const categories = [...new Set(products.map(p => p.category))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.addEventListener('click', () => {
            if (activeCategory === cat) {
                activeCategory = '';
            } else {
                activeCategory = cat;
            }
            updateCategoryButtons();
            render();
        });
        categoryBar.appendChild(btn);
    });
}
    
function updateCategoryButtons() {
    document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.textContent === activeCategory) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

function render() {
    const searchValue = document.getElementById('search').value.toLowerCase();
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    products
        .filter(p =>
    (!activeCategory || p.category === activeCategory) &&
    (p.name.toLowerCase().includes(searchValue) || 
     p.category.toLowerCase().includes(searchValue))
)

        .forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="img/${p.brand}/${p.image}" alt="${p.name}" class="product-image" loading="lazy">
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-BarCode">${p.BarCode}</div>
                    <div class="product-category">${p.category}</div>
                    <div class="product-price">cena sugerowana: ${p.price} PLN</div>
                    <div class="product-dimensions">
                        <span>${p.height}</span>
                        <span>${p.width}</span>
                        <span>${p.depth} cm</span>    
                    </div>
                </div>
            `;
            
            card.addEventListener('click', function() {
                const currentBrand = new URLSearchParams(window.location.search).get('brand');
                const link = `product.html?id=${encodeURIComponent(p.name)}&brand=${encodeURIComponent(currentBrand)}`;
                window.location.href = link;
            });
            
            productList.appendChild(card);
        });
}

function debounce(func, wait) {
    let timeout;
    return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

document.getElementById('search').addEventListener('input', debounce(render, 300));

</script>

</body>
</html>
