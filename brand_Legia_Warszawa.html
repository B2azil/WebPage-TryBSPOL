<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marka XYZ - Produkty</title>
    <!-- <link rel="stylesheet" href="css/reset.css"> -->
    <link rel="stylesheet" href="css/brand.css">
</head>
<body>

<header>
    <a href="main.html">&larr; Powrót</a>
    <img src="img/bspolska.png" alt="Logo marki" class="brand-logo">
</header>

<div class="search-bar">
    <input type="text" id="search" placeholder="Szukaj produktu...">
</div>

<div class="category-bar" id="categoryBar">
    <!-- Kategorie z CSV -->
</div>

<div class="product-list" id="productList">
    <!-- Produkty z CSV -->
</div>

<div id="categoryBar"></div>
<div id="productList"></div>

<!-- modal na szczegóły produktu -->


<!-- <div id="detailsModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,.55); align-items:center; justify-content:center;">
  <div style="background:#fff; color:#222; padding:30px; border-radius:15px; max-width:400px; text-align:left; position:relative;">
    <button id="closeModal" style="position:absolute;right:10px;top:7px;font-size:20px;">×</button>
    <h2 id="modalName"></h2>
    <img id="modalImg" src="" style="max-width:200px; border-radius:12px;" alt="">
    <p id="modalInfo"></p>
    <p id="modalPrice" style="font-weight:bold"></p>
    <div id="modalCat" style="color:#4B85FF"></div>
  </div>
</div> -->

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
let products = [];
let activeCategory = '';

async function loadProducts() {
    const response = await fetch('produkty_legia.csv');
    const data = await response.text();

    const results = Papa.parse(data, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: false,
          delimiter: ';'  // ustaw separator na średnik
        });
        products = results.data;

    generateCategories();
    render();
}

function generateCategories() {
    const categoryBar = document.getElementById('categoryBar');
    categoryBar.innerHTML = '';

    const categories = [...new Set(products.map(p => p.category))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.addEventListener('click', () => {
            if (activeCategory === cat) {
                activeCategory = '';
            } else {
                activeCategory = cat;
            }
            updateCategoryButtons();
            render();
        });
        categoryBar.appendChild(btn);
    });
}

function updateCategoryButtons() {
    document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.textContent === activeCategory) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

function render() {
    const searchValue = document.getElementById('search').value.toLowerCase();
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    products
        .filter(p => 
            (activeCategory === '' || p.category === activeCategory) &&
            (p.name.toLowerCase().includes(searchValue) || 
             p.category.toLowerCase().includes(searchValue))
        )
        .forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${p.image}" alt="${p.name}">
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div>
                        <span class="product-tag">${p.category}</span>
                    </div>
                    <div class="product-price">rekomendowana cena: ${p.price} zł</div>
                </div>
                <div class="dimensions">
                    <span>${p.height} cm</span>
                    <span>${p.width} cm</span>
                    <span>${p.depth} cm</span>    
                </div>
            `;
            // Kliknięcie przekierowuje do podstrony produktu
            card.addEventListener('click', function() {
                window.location.href = 'product.html?id=' + encodeURIComponent(p.name);
            });
            productList.appendChild(card);
        });
}

document.getElementById('search').addEventListener('input', render);

loadProducts();


</script>

</body>
</html>
