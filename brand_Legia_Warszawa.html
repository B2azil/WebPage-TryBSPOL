<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marka XYZ - Produkty</title>
    <link rel="stylesheet" href="css/TestBrand.css">
</head>
<body>

<header>
    <a href="main.html">&larr; Powr√≥t</a>
    <img src="img/bspolska.png" alt="Logo marki" class="brand-logo">
</header>

<div class="search-bar">
    <input type="text" id="search" placeholder="Szukaj produktu...">
</div>

<div class="category-bar" id="categoryBar">
    <!-- Kategorie z CSV -->
</div>

<div class="product-grid" id="productList">
    <!-- Produkty z CSV -->
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
let products = [];
let activeCategory = '';

async function loadProducts() {
    const response = await fetch('produkty_legia.csv');
    const data = await response.text();

    const results = Papa.parse(data, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: false,
          delimiter: ';'
        });
        products = results.data;

    generateCategories();
    render();
}

function generateCategories() {
    const categoryBar = document.getElementById('categoryBar');
    categoryBar.innerHTML = '';

    const categories = [...new Set(products.map(p => p.category))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = cat;
        btn.addEventListener('click', () => {
            if (activeCategory === cat) {
                activeCategory = '';
            } else {
                activeCategory = cat;
            }
            updateCategoryButtons();
            render();
        });
        categoryBar.appendChild(btn);
    });
}

function updateCategoryButtons() {
    document.querySelectorAll('.category-btn').forEach(btn => {
        if (btn.textContent === activeCategory) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

function render() {
    const searchValue = document.getElementById('search').value.toLowerCase();
    const productList = document.getElementById('productList');
    productList.innerHTML = '';

    products
        .filter(p => 
            (activeCategory === '' || p.category === activeCategory) &&
            (p.name.toLowerCase().includes(searchValue) || 
             p.category.toLowerCase().includes(searchValue))
        )
        .forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${p.image}" alt="${p.name}" class="product-image">
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-category">${p.category}</div>
                    <div class="product-price">cena sugerowana: ${p.price} PLN</div>
                    <div class="product-dimensions">
                        <span>${p.height}</span>
                        <span>${p.width}</span>
                        <span>${p.depth} cm</span>    
                    </div>
                </div>
            `;
            
            card.addEventListener('click', function() {
                window.location.href = 'product.html?id=' + encodeURIComponent(p.name);
            });
            
            productList.appendChild(card);
        });
}

document.getElementById('search').addEventListener('input', render);

loadProducts();
</script>

</body>
</html>
