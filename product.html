<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Szczegóły produktu</title>
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/product.css">
  <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css" />
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
 
</head>
<body>
  <div class="product-container" id="productDetails">
    <p>Ładowanie danych produktu...</p>
  </div>
  
  <script type="module">
    import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js';

    async function loadProductDetails() {
      const params = new URLSearchParams(window.location.search);
      const prodId = params.get('id');

      if (!prodId) {
        document.getElementById('productDetails').innerHTML = '<p>Nie podano produktu.</p>';
        return;
      }

      try {
        const response = await fetch('produkty_legia.csv');
        const data = await response.text();

      const results = Papa.parse(data, {
        header: true,
        skipEmptyLines: true,
        dynamicTyping: false,
        delimiter: ';'  // ustaw separator na średnik
      });
      const products = results.data;

      // Odnajdź produkt po nazwie (prodId jest w URL zakodowane, więc dekoduj)
      const decodedProdId = decodeURIComponent(prodId);
      const product = products.find(p => p.name === decodedProdId);

      if (!product) {
        document.getElementById('productDetails').innerHTML = '<p>Produkt nie znaleziony.</p>';
        return;
      }
        
      // Dynamiczne wyświetlanie dostępnych zdjęć
      const images = [
        product.image, product.image2, product.image3,
        product.image4, product.image5, product.image6,
        product.image7, product.image8
      ].filter(src => src && src.trim() !== '');
      
      
      // Wygeneruj galerię: duże zdjęcie + miniatury
      const imagesHtml = images.map((src, index) => 
        `<a href="${src}" 
          data-pswp-width="xx" 
          data-pswp-height="xx" 
          target="_blank" 
          class="pswp-gallery">
          <img src="${src}" alt="${product.name} zdjęcie ${index + 1}" loading="lazy">
        </a>`).join('');

      /*
      const galleryHtml = images.length > 0 ? `
        <div class="gallery">
          <div class="main-image">
            <button class="arrow prev">⟨</button> 
            <img id="currentImage" src="${images[0]}" alt="${product.name}" loading="lazy">
            <button class="arrow next">⟩</button>
          </div>
          <div class="thumbnails">
            ${images.map((src, i) => `
              <a href="${src}"  
              data-pswp-width="1200"
              data-pswp-height="1200"
              data-index="${i}">
              <img src="${src}" alt="${product.name} miniatura" loading="lazy">
              </a>
            `).join('')}
          </div>
        </div>
      ` : '';

      */
        

      // Dynamiczne wyświetlanie dostępnych informacji o produkcie
      const infoFields = ['info1', 'info2', 'info3', 'info4',
                          'info5', 'info6', 'info7', 'info8',
                          'info9', 'info10', 'info11', 'info12',
                          'info13', 'info14', 'info15', 'info16'
                        ];
      const infosHtml = infoFields
        .map(field => product[field])
        .filter(text => text && text.trim() !== '')
        .map(text => `<p class="description">${text}</p>`)
        .join('');  

        
      // Wyświetl szczegóły / Renderowanie informacji z pliku
      document.getElementById('productDetails').innerHTML = `
        <div class="parent">

        <div class="product-basic">
          <h1>${product.name}</h1>
          <h6>SKU: ${product.sku}</h6>
          <div class="price">Cena: ${product.price} zł</div>
        </div>

        <div class="product-images">${imagesHtml}</div>

        <div class="category">Kategoria: ${product.category}</div>

        <a href="${product.link}" target="_blank" class="link"><img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Allegro.pl_sklep.svg" alt="Allegro"></a>
          
          
        <div class="product-description">
          <b>Opis produktu</b>
          ${infosHtml}
        </div>

        <div class="product-data">
          <b>Dane techniczne produktu</b>
          <div>Wysokość: ${product.height} cm</div>
          <div>Szerokość: ${product.width} cm</div>
          <div>Głębokość: ${product.depth} cm</div>
          <div>Waga produktu: ${product.weight} g</div>
          <div>Materiał: ${product.material}</div>
          <div>Kolor dominujący: ${product.color}</div>
        </div>

        <span class="top">
          <a href="${product.brandPage || 'main.html'}" class="back-link">← Powrót do listy ${product.brand}</a>
        </span>

      </div>
    `;

    // Miniatury
    document.querySelector('.product-images').innerHTML = imagesHtml;
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.product-images',
      children: 'a',
      pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.min.js')
    });
    lightbox.init();








    /*
    const thumbs = document.querySelectorAll('.thumbnails img');
    const currentImg = document.getElementById('currentImage');
    let currentIndex = 0;

    function showImage(index) {
      if (index < 0) index = images.length - 1;
      if (index >= images.length) index = 0;
      currentIndex = index;
      currentImg.src = images[currentIndex];
      thumbs.forEach(t => t.classList.remove('active'));
      thumbs[currentIndex].classList.add('active');
    }*/

/*    //obsługa Miniatury
    thumbs.forEach((thumb, i) => {
      thumb.addEventListener('click', () => showImage(i));
    });
    thumbs[0]?.classList.add('active');

    // Strzałki
    document.querySelector('.arrow.prev')?.addEventListener('click', () => showImage(currentIndex - 1));
    document.querySelector('.arrow.next')?.addEventListener('click', () => showImage(currentIndex + 1));

    // PhotoSwipe
    const pswp = new PhotoSwipeLightbox({
      gallery: '.gallery',
      children: '.thumbnails a',
      pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js')
    });
    pswp.init();

    // Kliknięcie w duże zdjęcie = powiększenie
    currentImg.addEventListener('click', () => {
      pswp.loadAndOpen(currentIndex);
    });
*/

    } catch (error) {
      document.getElementById('productDetails').innerHTML = '<p>Błąd podczas ładowania danych produktu.</p>';
      console.error('Błąd ładowania CSV:', error);
    }
  }

    loadProductDetails();
  </script>
</body>
</html>
